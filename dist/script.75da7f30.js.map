{"version":3,"sources":["script.js"],"names":["table","document","querySelector","listContainer","endpoint","wait","ms","Promise","resolve","setTimeout","fetchPersons","respose","fetch","persons","json","generatePersonHtml","personList","today","Date","calcDate","date1","date2","diff","Math","floor","getTime","day","days","message","map","data","id","picture","firstName","lastName","birthday","toLocaleDateString","join","displayPersonsList","sortedPersons","sort","person1","person2","listHtml","innerHTML","editPerson","e","editIcon","target","closest","dataset","editPersonPopup","destroyPopup","popup","classList","remove","personToEdit","find","person","formPopup","createElement","add","insertAdjacentHTML","body","appendChild","addEventListener","preventDefault","lastname","value","firstname","dispatchEvent","CustomEvent","cancel","cancelButton","deletePerson","deleteButton","tableRow","idToDelete","deleteList","personsToKeep","filter","deleteContainerPopup","confirmDeleteButton","cancelDeleteButton","mirrorToLocalStorage","localStorage","setItem","JSON","stringify","initLocalStorage","personListString","getItem","personsList","parse","length","window"],"mappings":"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","file":"script.75da7f30.js","sourceRoot":"..","sourcesContent":["// Grab all the necesssary elements\r\nconst table = document.querySelector(\"table\");\r\nconst listContainer = document.querySelector(\".contents_container\");\r\n\r\n// Importing the data\r\nconst endpoint = \"./people.json\";\r\n\r\n// This is reussable wait function that we can always use when we wanna wait before firing sth\r\nfunction wait(ms = 0) {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\n\r\n\r\n// Fetch the data\r\nasync function fetchPersons() {\r\n    const respose = await fetch(`${endpoint}?`);\r\n    let persons = await respose.json();\r\n\r\n    //get the array from ls\r\n    const generatePersonHtml = (personList) => {\r\n        // To get the date\r\n        const today = new Date()\r\n\r\n        // This is a function that handles the date and we'll call this when mapping the object\r\n        const calcDate = (date1, date2) => {\r\n            let diff = Math.floor(date1.getTime() - date2.getTime());\r\n            let day = 1000 * 60 * 60 * 24;\r\n            let days = Math.floor(diff / day);\r\n            let message = days;\r\n\r\n            // Return the message\r\n            return message\r\n        }\r\n\r\n        // Show the list in the html\r\n        return personList.map(data =>\r\n            `<tr data-id=\"${data.id}\" class=\"list_container\">\r\n            <td scope=\"row\">\r\n             <img src=\"${data.picture}\" alt>\r\n             </td>\r\n            <td class=\"persons_name\">\r\n                <span class=\"name d-block\">\r\n                  ${data.firstName}\r\n                  ${data.lastName} \r\n                </span>\r\n                <span class=\"date d-block\">\r\n                   Turns on the ${new Date(data.birthday).toLocaleDateString()}\r\n                </span>\r\n            </td>\r\n         <td class=\"days\">${calcDate(today, new Date(new Date(data.birthday).toLocaleDateString()))} Days</td>\r\n            <td> \r\n                <button class=\"edit bg-primary text-white\" type=\"button\">\r\n                    Edit\r\n                </button>  \r\n            </td>\r\n            <td class=\"delete\">\r\n                <button class=\"delete_btn text-danger\">\r\n                    Delete\r\n                </button>\r\n            </td>\r\n        </tr>`\r\n        ).join(\"\");\r\n    }\r\n\r\n    // Display the persons ' list in the html\r\n    const displayPersonsList = () => {\r\n        // Sorting the persons by birthday, from the soonest to the furthest\r\n        const sortedPersons = persons.sort((person1, person2) => person2.birthday - person1.birthday);\r\n        const listHtml = generatePersonHtml(sortedPersons);\r\n        listContainer.innerHTML = listHtml;\r\n    }\r\n    displayPersonsList();\r\n\r\n    // A function that edits the person\r\n    const editPerson = (e) => {\r\n        // Open the modal \r\n        return new Promise(function (resolve) {\r\n            const editIcon = e.target.closest(\".edit\");\r\n            // If the target is the edit icon, add the className to open the popup\r\n            if (editIcon) {\r\n                const id = e.target.closest(\".list_container\").dataset.id;\r\n                editPersonPopup(id);\r\n            }\r\n        });\r\n    };\r\n\r\n    // Distroy the popup while canceling or save\r\n    async function destroyPopup(popup) {\r\n        popup.classList.remove('open');\r\n        await wait(500);\r\n        // remove the popup from the DOM\r\n        popup.remove();\r\n        // remove it from the js memory\r\n        popup = null;\r\n    }\r\n\r\n    // Edit the form\r\n    function editPersonPopup(id) {\r\n        const personToEdit = persons.find(person => person.id == id);\r\n        // Create the form element\r\n        let formPopup = document.createElement('form');\r\n        formPopup.classList.add('popup');\r\n        formPopup.insertAdjacentHTML('afterbegin', `\r\n        <div class=\"container bg-primary\">\r\n            <p> Edit the person</p>\r\n            <label class=\"d-block\" for=\"firstname\">First Name:</label>\r\n            <input type=\"text\" name=\"firstname\" id=\"firstname\" value=\"${personToEdit.firstName}\" required>\r\n            <label class=\"d-block\" for=\"lastname\">Last Name:</label>\r\n            <input type=\"text\" name=\"lastname\" id=\"lastname\" value=\"${personToEdit.lastName}\" required>\r\n            <label class=\"d-block\" for=\"birthday\"> Birthday:</label>\r\n            <input type=\"text\" name=\"birthday\" id=\"birthday\" value=\"${personToEdit.birthday}\" required>\r\n            <label class=\"d-block\" for=\"url\"> Image url:</label>\r\n            <input type=\"text\" name=\"picture\" id=\"picture\" value=\"${personToEdit.picture}\" required>\r\n            <div class=\"button_container\">\r\n                <button class=\"submit_button\" type=\"submit\" data-id=\"${id}\"> Save</button>\r\n                <button class=\"cancel\" name=\"cancel\" type=\"button\" data-id=\"${id}\"> Cancel</button>\r\n\t\t    </div>\r\n        </div>`);\r\n        document.body.appendChild(formPopup);\r\n        formPopup.classList.add(\"open\");\r\n\r\n        // Save the changes\r\n        formPopup.addEventListener(\"submit\", (e) => {\r\n            e.preventDefault();\r\n            personToEdit.lastName = formPopup.lastname.value;\r\n            personToEdit.firstName = formPopup.firstname.value;\r\n            personToEdit.birthday = formPopup.birthday.value;\r\n            personToEdit.picture = formPopup.picture.value;\r\n            // Display in the list\r\n            displayPersonsList();\r\n            destroyPopup(formPopup)\r\n            table.dispatchEvent(new CustomEvent('updateList'));\r\n        })\r\n\r\n        // Remove form by clicking the cancel button\r\n        if (formPopup.cancel) {\r\n            const cancelButton = formPopup.cancel;\r\n            cancelButton.addEventListener('click', () => {\r\n                destroyPopup(formPopup);\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    // Delete list from the local storage\r\n    const deletePerson = (e) => {\r\n        const deleteButton = e.target.closest(\".delete_btn\");\r\n        if (deleteButton) {\r\n            const tableRow = e.target.closest('tr');\r\n            const idToDelete = tableRow.dataset.id;\r\n            deleteList(idToDelete);\r\n        }\r\n    }\r\n\r\n    const deleteList = (idToDelete) => {\r\n        const personsToKeep = persons.filter(person => person.id !== idToDelete);\r\n        // Show a warning before the user decides\r\n        let deleteContainerPopup = document.createElement('div');\r\n        deleteContainerPopup.classList.add('popup');\r\n        deleteContainerPopup.insertAdjacentHTML('afterbegin', `\r\n            <div class=\"delete_container bg-warning\">\r\n\t\t\t\t<p class=\"warning\">\r\n\t\t\t\t\tAre you sure you want to delete?\r\n\t\t\t\t</p>\r\n\t\t\t\t<button type=\"button\" name=\"confirm\" class=\"confirm_delete\"> Yes</button>\r\n\t\t\t\t<button type=\"button\" name=\"cancel\" class=\"cancel_delete\">Not yet</button>\r\n            </div>`);\r\n        document.body.appendChild(deleteContainerPopup)\r\n        deleteContainerPopup.classList.add(\"open\");\r\n\r\n        // Look for the confirm delete button and delete it\r\n        deleteContainerPopup.addEventListener(\"click\", (e) => {\r\n            e.preventDefault()\r\n            const confirmDeleteButton = e.target.closest(\"button.confirm_delete\");\r\n            if (confirmDeleteButton) {\r\n                persons = personsToKeep;\r\n                displayPersonsList(persons);\r\n                destroyPopup(deleteContainerPopup);\r\n                table.dispatchEvent(new CustomEvent('updateList'));\r\n            }\r\n        })\r\n\r\n        // Cancel if the user doesn't wanna delete yet\r\n        deleteContainerPopup.addEventListener(\"click\", (e) => {\r\n            e.preventDefault()\r\n            const cancelDeleteButton = e.target.closest(\"button.cancel_delete\");\r\n            if (cancelDeleteButton) {\r\n                destroyPopup(deleteContainerPopup);\r\n            }\r\n        })\r\n        table.dispatchEvent(new CustomEvent('updateList'));\r\n    }\r\n\r\n    // Save in the local storage\r\n    const mirrorToLocalStorage = () => {\r\n        localStorage.setItem('persons', JSON.stringify(persons));\r\n    }\r\n\r\n    // restor from local storage\r\n    const initLocalStorage = () => {\r\n        const personListString = localStorage.getItem('persons');\r\n        const personsList = JSON.parse(personListString);\r\n        if (personsList.length) {\r\n            persons = personsList;\r\n            displayPersonsList()\r\n        }\r\n        table.dispatchEvent(new CustomEvent('updateList'));\r\n    };\r\n\r\n    // All event listners\r\n    window.addEventListener(\"click\", deletePerson);\r\n    window.addEventListener(\"click\", editPerson);\r\n    table.addEventListener(\"updateList\", mirrorToLocalStorage);\r\n    initLocalStorage();\r\n}\r\n\r\n\r\nfetchPersons();"]}